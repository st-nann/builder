{"remainingRequest":"/Users/nan3ds/3DsProject/pam-builder/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nan3ds/3DsProject/pam-builder/src/pages/Text.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/nan3ds/3DsProject/pam-builder/src/pages/Text.vue","mtime":1607429898831},{"path":"/Users/nan3ds/3DsProject/pam-builder/node_modules/cache-loader/dist/cjs.js","mtime":1605252086732},{"path":"/Users/nan3ds/3DsProject/pam-builder/node_modules/babel-loader/lib/index.js","mtime":1605690691451},{"path":"/Users/nan3ds/3DsProject/pam-builder/node_modules/ts-loader/index.js","mtime":1606390504017},{"path":"/Users/nan3ds/3DsProject/pam-builder/node_modules/cache-loader/dist/cjs.js","mtime":1605252086732},{"path":"/Users/nan3ds/3DsProject/pam-builder/node_modules/vue-loader/lib/index.js","mtime":1605690691983}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJwppbXBvcnQgcXVpbGwgZnJvbSAncXVpbGwnCmltcG9ydCB7IENvbXBvbmVudCwgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJwppbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tICcuLi9jb3JlL0Jhc2VDb21wb25lbnQnCgpjb25zdCBRdWlsbCA9IHF1aWxsIGFzIGFueQpjb25zdCBEZWx0YSA9IFF1aWxsLmltcG9ydCgnZGVsdGEnKQoKQENvbXBvbmVudApleHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0UGFnZSBleHRlbmRzIEJhc2VDb21wb25lbnQgewogIEBQcm9wKFN0cmluZykgZWxlbWVudElkITogc3RyaW5nCiAgQFByb3AoU3RyaW5nKSBlbGVtZW50TmFtZSE6IHN0cmluZwogIEBQcm9wKCkgZWxlbWVudFByb3BzITogYW55CiAgQFByb3AoKSBlbGVtZW50VmFsdWUhOiBhbnkKCiAgbWFuYWdlbWVudDogYW55ID0ge30KICBwcmV2aWV3RGF0YTogYW55ID0ge30KICBmb290ZXJEYXRhID0ge30KICBlZGl0b3I6IGFueSA9IG51bGwKICBjb250ZW50SHRtbDogYW55ID0gbnVsbAoKICBjcmVhdGVkKCkgewogICAgdGhpcy5kb1JlbmRlclVwZGF0ZUVsZW1lbnQoKQogIH0KCiAgdXBkYXRlZCgpIHsKICAgIHRoaXMuZG9SZW5kZXJVcGRhdGVFbGVtZW50KCkKICB9CgogIGRvUmVuZGVyVXBkYXRlRWxlbWVudCgpIHsKICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjbW9kYWwtZWRpdC0ke3RoaXMuZWxlbWVudElkfWApCiAgICAgIGNvbnN0IHRvb2xiYXIgPSBtb2RhbD8uZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncWwtdG9vbGJhcicpWzBdCiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHRvb2xiYXIpKSB7CiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgICAgIG1vZHVsZXM6IHsKICAgICAgICAgICAgdG9vbGJhcjogWwogICAgICAgICAgICAgIFt7ICdmb250JzogW10gfV0sCiAgICAgICAgICAgICAgW3sgJ3NpemUnOiBbJ3NtYWxsJywgZmFsc2UsICdsYXJnZScsICdodWdlJ10gfV0sCiAgICAgICAgICAgICAgW3sgJ2NvbG9yJzogW10gfV0sCiAgICAgICAgICAgICAgWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnXSwKICAgICAgICAgICAgICBbeyAnYWxpZ24nOiBbXSB9XSwKICAgICAgICAgICAgICBbJ2xpbmsnXSwKICAgICAgICAgICAgICBbeyAnaGVhZGVyJzogWzEsIDIsIDMsIDQsIDUsIDYsIGZhbHNlXSB9XQogICAgICAgICAgICBdCiAgICAgICAgICB9LAogICAgICAgICAgdGhlbWU6ICdzbm93JywKICAgICAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLmVsZW1lbnRWYWx1ZSA/ICcnIDogJ1R5cGUgY29udGVudCAuLi4nCiAgICAgICAgfQogICAgICAgIHRoaXMuZWRpdG9yID0gbmV3IFF1aWxsKGAjZWRpdG9yLSR7dGhpcy5lbGVtZW50SWR9YCwgb3B0aW9ucykKICAgICAgfQogICAgICB0aGlzLmVkaXRvci5yb290LmlubmVySFRNTCA9ICcnCiAgICAgIGlmICh0aGlzLmVsZW1lbnRWYWx1ZSAmJiB0aGlzLmVsZW1lbnRWYWx1ZS5qc29uICYmIHRoaXMuZWxlbWVudFZhbHVlLmh0bWwpIHsKICAgICAgICB0aGlzLmVkaXRvci51cGRhdGVDb250ZW50cyhuZXcgRGVsdGEodGhpcy5lbGVtZW50VmFsdWUuanNvbikpCiAgICAgICAgdGhpcy5lZGl0b3Iucm9vdC5pbm5lckhUTUwgPSB0aGlzLmVsZW1lbnRWYWx1ZS5odG1sCiAgICAgIH0KICAgICAgdGhpcy5jb250ZW50SHRtbCA9IHRoaXMuZWRpdG9yLnJvb3QuaW5uZXJIVE1MCiAgICB9KQogIH0KCiAgZG9Bc3NpZ25TdHlsZSgpIHsKICAgIGNvbnN0IHByZXZpZXdTdHlsZTogYW55ID0ge30KICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLnByZXZpZXdEYXRhKSAhPT0gJ3t9JykgewogICAgICBpZiAodGhpcy5wcmV2aWV3RGF0YVsnYm9yZGVyLWJvdHRvbSddKSB7CiAgICAgICAgY29uc3QgYm9yZGVyID0gdGhpcy5wcmV2aWV3RGF0YVsnYm9yZGVyLWJvdHRvbSddCiAgICAgICAgcHJldmlld1N0eWxlWydib3JkZXItYm90dG9tJ10gPSBgJHtib3JkZXIud2lkdGh9ICR7Ym9yZGVyLnN0eWxlfSAke2JvcmRlci5jb2xvcn1gCiAgICAgIH0KICAgICAgaWYgKHRoaXMucHJldmlld0RhdGFbJ2JhY2tncm91bmQtY29sb3InXSkgewogICAgICAgIHByZXZpZXdTdHlsZVsnYmFja2dyb3VuZC1jb2xvciddID0gdGhpcy5wcmV2aWV3RGF0YVsnYmFja2dyb3VuZC1jb2xvciddCiAgICAgIH0KICAgIH0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBlZGl0b3ItJHt0aGlzLmVsZW1lbnRJZH1gKT8uc2V0QXR0cmlidXRlKAogICAgICAnc3R5bGUnLAogICAgICBKU09OLnN0cmluZ2lmeSh7Li4ucHJldmlld1N0eWxlfSkKICAgICAgICAuc3Vic3RyaW5nKDEsIEpTT04uc3RyaW5naWZ5KHsuLi5wcmV2aWV3U3R5bGV9KS5sZW5ndGggLSAxKQogICAgICAgIC5yZXBsYWNlQWxsKCcsJywgJzsnKQogICAgICAgIC5yZXBsYWNlQWxsKCciJywgJycpCiAgICApCiAgfQoKICBvblVwZGF0ZU1hbmFnZW1lbnQoZGF0YTogYW55KSB7CiAgICB0aGlzLm1hbmFnZW1lbnQgPSBkYXRhCiAgICBpZiAoCiAgICAgICgKICAgICAgICB0aGlzLmVkaXRvciAmJgogICAgICAgIHRoaXMuZWRpdG9yLnJvb3QgJiYKICAgICAgICB0aGlzLmVsZW1lbnRWYWx1ZSAmJgogICAgICAgIHRoaXMuZWxlbWVudFZhbHVlLmh0bWwgPT09IHRoaXMuZWRpdG9yLnJvb3QuaW5uZXJIVE1MCiAgICAgICkgfHwKICAgICAgXy5pc0VtcHR5KHRoaXMuY29udGVudEh0bWwpCiAgICApIHsKICAgICAgdGhpcy5kb0VtaXREYXRhKCkKICAgIH0KICB9CgogIG9uVXBkYXRlUHJldmlldyhkYXRhOiBhbnkpIHsKICAgIHRoaXMucHJldmlld0RhdGEgPSB7fQogICAgdGhpcy5wcmV2aWV3RGF0YSA9IGRhdGEKICAgIHRoaXMuZG9Bc3NpZ25TdHlsZSgpCiAgfQoKICBvblVwZGF0ZUZvb3RlclBhbmVsRGF0YShkYXRhOiBhbnkpIHsKICAgIHRoaXMuZm9vdGVyRGF0YSA9IGRhdGEKICAgIHRoaXMubWFuYWdlbWVudC5lZGl0ID0gZmFsc2UKICAgIGlmIChkYXRhKSB7IHRoaXMuZG9FbWl0RGF0YSgpIH0KICB9CgogIGRvRW1pdERhdGEoKSB7CiAgICBpZiAodGhpcy5tYW5hZ2VtZW50LmRlbGV0ZSkgewogICAgICB0aGlzLiRlbWl0KCdkZWxldGUnLCB0aGlzLmVsZW1lbnRJZCkKICAgIH0gZWxzZSBpZiAodGhpcy5tYW5hZ2VtZW50LmR1cGxpY2F0ZSkgewogICAgICB0aGlzLiRlbWl0KCdkdXBsaWNhdGUnLCB7CiAgICAgICAgaWQ6IHRoaXMuZWxlbWVudElkLAogICAgICAgIHBvc2l0aW9uOiB0aGlzLm1hbmFnZW1lbnQucG9zaXRpb24sCiAgICAgICAgZHVwbGljYXRlOiB0aGlzLm1hbmFnZW1lbnQuZHVwbGljYXRlCiAgICAgIH0pCiAgICB9IGVsc2UgewogICAgICB0aGlzLiRlbWl0KCdkb25lJywgewogICAgICAgIGlkOiB0aGlzLmVsZW1lbnRJZCwKICAgICAgICBwcm9wczogeyAuLi50aGlzLmVsZW1lbnRQcm9wcyB9IHx8IHsgLi4udGhpcy5mb290ZXJEYXRhIH0sCiAgICAgICAgdmFsdWU6IHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLmVkaXRvciAmJiB0aGlzLmVkaXRvci5yb290CiAgICAgICAgICA/IHsganNvbjogdGhpcy5lZGl0b3IuZWRpdG9yLmRlbHRhLm9wcywgaHRtbDogdGhpcy5lZGl0b3Iucm9vdC5pbm5lckhUTUwgfQogICAgICAgICAgOiB1bmRlZmluZWQKICAgICAgfSkKICAgIH0KICB9CgogIGRvRW1pdEFkZEVsZW1lbnQoZGF0YTogYW55KSB7CiAgICB0aGlzLiRlbWl0KCdhZGQnLCB7IGlkOiB0aGlzLmVsZW1lbnRJZCwgLi4uZGF0YSB9KQogIH0KCiAgQFdhdGNoKCdtYW5hZ2VtZW50JywgeyBkZWVwOiB0cnVlfSkKICBvbkVkaXQoKSB7CiAgICBpZiAodGhpcy4kcmVmc1tgbW9kYWwtZWRpdC0ke3RoaXMuZWxlbWVudElkfWBdKSB7CiAgICAgIHRoaXMuJHJlZnNbYG1vZGFsLWVkaXQtJHt0aGlzLmVsZW1lbnRJZH1gXS5pc09wZW5Nb2RhbCA9IHRoaXMubWFuYWdlbWVudC5lZGl0CiAgICB9CiAgICBjb25zdCBzZWxmID0gdGhpcwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHNlbGYuZWRpdG9yLmZvY3VzKCkKICAgICAgc2VsZi5lZGl0b3Iuc2V0U2VsZWN0aW9uKHNlbGYuZWRpdG9yLnJvb3QudGV4dENvbnRlbnQubGVuZ3RoKQogICAgfSwgMTAwKQogIH0KfQo="},{"version":3,"sources":["Text.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Text.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  <span :style=\"`width: 100%;`\">\n    <BoxComponent\n      :element=\"elementName\"\n      :action=\"management\"\n      @click=\"doEmitAddElement\"\n    >\n      <template slot=\"text-content\">\n        <div\n          v-if=\"editor && editor.root\"\n          :id=\"`content-${elementId}`\"\n          class=\"ql-editor text-content\"\n          v-html=\"contentHtml\"\n        />\n      </template>\n      <template slot=\"button-management\">\n        <MainButtonComponent\n          class=\"button-box\"\n          :elementId=\"elementId\"\n          @click=\"onUpdateManagement\"\n        />\n      </template>\n    </BoxComponent>\n    <ModalComponent\n      :ref=\"`modal-edit-${elementId}`\"\n      :modal=\"{ width: 700, action: 'edit', button: { custom: true } }\"\n      :elementId=\"elementId\"\n    >\n      <template slot=\"content\">\n        <div :id=\"`editor-${elementId}`\" class=\"editor\"/>\n      </template>\n      <template slot=\"action-custom\">\n        <FooterPanel\n          :elementProps=\"elementProps\"\n          :elementName=\"elementName\"\n          :management=\"management\"\n          @change=\"onUpdatePreview\"\n          @click=\"onUpdateFooterPanelData\"\n        />\n      </template>\n    </ModalComponent>\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport _ from 'lodash'\nimport quill from 'quill'\nimport { Component, Prop, Watch } from 'vue-property-decorator'\nimport BaseComponent from '../core/BaseComponent'\n\nconst Quill = quill as any\nconst Delta = Quill.import('delta')\n\n@Component\nexport default class TextPage extends BaseComponent {\n  @Prop(String) elementId!: string\n  @Prop(String) elementName!: string\n  @Prop() elementProps!: any\n  @Prop() elementValue!: any\n\n  management: any = {}\n  previewData: any = {}\n  footerData = {}\n  editor: any = null\n  contentHtml: any = null\n\n  created() {\n    this.doRenderUpdateElement()\n  }\n\n  updated() {\n    this.doRenderUpdateElement()\n  }\n\n  doRenderUpdateElement() {\n    this.$nextTick(() => {\n      const modal = document.querySelector(`#modal-edit-${this.elementId}`)\n      const toolbar = modal?.getElementsByClassName('ql-toolbar')[0]\n      if (_.isUndefined(toolbar)) {\n        const options = {\n          modules: {\n            toolbar: [\n              [{ 'font': [] }],\n              [{ 'size': ['small', false, 'large', 'huge'] }],\n              [{ 'color': [] }],\n              ['bold', 'italic', 'underline'],\n              [{ 'align': [] }],\n              ['link'],\n              [{ 'header': [1, 2, 3, 4, 5, 6, false] }]\n            ]\n          },\n          theme: 'snow',\n          placeholder: this.elementValue ? '' : 'Type content ...'\n        }\n        this.editor = new Quill(`#editor-${this.elementId}`, options)\n      }\n      this.editor.root.innerHTML = ''\n      if (this.elementValue && this.elementValue.json && this.elementValue.html) {\n        this.editor.updateContents(new Delta(this.elementValue.json))\n        this.editor.root.innerHTML = this.elementValue.html\n      }\n      this.contentHtml = this.editor.root.innerHTML\n    })\n  }\n\n  doAssignStyle() {\n    const previewStyle: any = {}\n    if (JSON.stringify(this.previewData) !== '{}') {\n      if (this.previewData['border-bottom']) {\n        const border = this.previewData['border-bottom']\n        previewStyle['border-bottom'] = `${border.width} ${border.style} ${border.color}`\n      }\n      if (this.previewData['background-color']) {\n        previewStyle['background-color'] = this.previewData['background-color']\n      }\n    }\n    document.getElementById(`editor-${this.elementId}`)?.setAttribute(\n      'style',\n      JSON.stringify({...previewStyle})\n        .substring(1, JSON.stringify({...previewStyle}).length - 1)\n        .replaceAll(',', ';')\n        .replaceAll('\"', '')\n    )\n  }\n\n  onUpdateManagement(data: any) {\n    this.management = data\n    if (\n      (\n        this.editor &&\n        this.editor.root &&\n        this.elementValue &&\n        this.elementValue.html === this.editor.root.innerHTML\n      ) ||\n      _.isEmpty(this.contentHtml)\n    ) {\n      this.doEmitData()\n    }\n  }\n\n  onUpdatePreview(data: any) {\n    this.previewData = {}\n    this.previewData = data\n    this.doAssignStyle()\n  }\n\n  onUpdateFooterPanelData(data: any) {\n    this.footerData = data\n    this.management.edit = false\n    if (data) { this.doEmitData() }\n  }\n\n  doEmitData() {\n    if (this.management.delete) {\n      this.$emit('delete', this.elementId)\n    } else if (this.management.duplicate) {\n      this.$emit('duplicate', {\n        id: this.elementId,\n        position: this.management.position,\n        duplicate: this.management.duplicate\n      })\n    } else {\n      this.$emit('done', {\n        id: this.elementId,\n        props: { ...this.elementProps } || { ...this.footerData },\n        value: this.editor && this.editor.editor && this.editor.root\n          ? { json: this.editor.editor.delta.ops, html: this.editor.root.innerHTML }\n          : undefined\n      })\n    }\n  }\n\n  doEmitAddElement(data: any) {\n    this.$emit('add', { id: this.elementId, ...data })\n  }\n\n  @Watch('management', { deep: true})\n  onEdit() {\n    if (this.$refs[`modal-edit-${this.elementId}`]) {\n      this.$refs[`modal-edit-${this.elementId}`].isOpenModal = this.management.edit\n    }\n    const self = this\n    setTimeout(() => {\n      self.editor.focus()\n      self.editor.setSelection(self.editor.root.textContent.length)\n    }, 100)\n  }\n}\n</script>\n\n<style lang=\"scss\">\n  @import '../assets/scss/Main.scss';\n</style>\n"]}]}